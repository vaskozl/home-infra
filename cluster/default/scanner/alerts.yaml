apiVersion: operator.victoriametrics.com/v1beta1
kind: VMRule
metadata:
  name: container-vulns-alerts
spec:
  groups:
    - name: container-vulns
      interval: 1m
      rules:
        - alert: ContainerCriticalVulns
          expr: |
            scanner_vulnerabilities{severity=~"Critical|High",fixable="yes"} > 0
          for: 1d
          labels:
            severity: critical
          annotations:
            summary: "Critical/High with fix vulnerability in {{ $labels.image }}"
            description: |
              Container {{ $labels.image }} has a Critical/High vulnerability:
              CVE: {{ $labels.id }}
              Package: {{ $labels.pkg }}

        - alert: ContainerMediumVulnsFixAvailable
          expr: |
            scanner_vulnerabilities{severity=~"Medium",fixable="yes"} > 0
          for: 7d
          labels:
            severity: warning
          annotations:
            summary: "Medium vulnerability with fix in {{ $labels.image }}"
            description: |
              Container {{ $labels.image }} has a Medium vulnerability with a fix available:
              CVE: {{ $labels.id }}
              Package: {{ $labels.pkg }}

        - alert: ContainerTooManyVulns
          expr: |
            sum(scanner_vulnerabilities) by (image) > 20
          for: 1d
          labels:
            severity: warning
          annotations:
            summary: "Too many vulnerabilities in {{ $labels.image }}"
            description: |
              Container {{ $labels.image }} has more than 20 vulnerabilities in total.
