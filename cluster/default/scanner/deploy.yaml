apiVersion: apps/v1
kind: Deployment
metadata:
  name: scanner
spec:
  template:
    spec:
      serviceAccountName: scanner-sa
      containers:
        - name: scanner-container
          image: ghcr.io/vaskozl/perl-mojolicious:9.41@sha256:4d47e2af8e24854014a5567e8d3257e87147fc26106391cf60b5f1924c1bfe13
          env:
            - name: SCAN_MAIL_TO
              value: scans@sko.ai
            - name: SCAN_MAIL_FROM
              value: scans@sko.ai
            - name: SCAN_MAIL_SERVER
              value: mx-maddy.mailserver.svc.cluster.local:2225
          args:
            - /script/scan-containers.pl
          ports:
            - name: metrics
              containerPort: 9090
          volumeMounts:
            - name: script
              mountPath: /script
      volumes:
        - name: script
          configMap:
            name: script
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: scanner
spec:
  selector:
    matchLabels:
      app: scanner
  podMetricsEndpoints:
    - port: metrics
      path: /metrics
      interval: 300s
